# ðŸ”„ DIAGRAMME DE FLUX SIMPLIFIÃ‰ - ARXIPULSE

## ðŸ“± FLUX UTILISATEUR â†’ RÃ‰SULTAT

### MODE 1: UPLOAD DE DOCUMENT

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UTILISATEUR â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Upload PDF
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND       â”‚
â”‚  App.js         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ POST /ingest
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND        â”‚
â”‚  routes.py      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ ingest_document()
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PIPELINE D'INDEXATION          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ loader.py                â”‚  â”‚
â”‚  â”‚ â””â”€> Extrait texte PDF    â”‚  â”‚
â”‚  â”‚                          â”‚  â”‚
â”‚  â”‚ chunker.py               â”‚  â”‚
â”‚  â”‚ â””â”€> DÃ©coupe en chunks    â”‚  â”‚
â”‚  â”‚                          â”‚  â”‚
â”‚  â”‚ embeddings.py            â”‚  â”‚
â”‚  â”‚ â””â”€> GÃ©nÃ¨re vecteurs      â”‚  â”‚
â”‚  â”‚                          â”‚  â”‚
â”‚  â”‚ chroma_store.py          â”‚  â”‚
â”‚  â”‚ â””â”€> Sauvegarde dans DB   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Retourne doc_id
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND       â”‚
â”‚  (doc_id stockÃ©)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

       â”‚
       â”‚ 2. Utilisateur pose question
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND       â”‚
â”‚  POST /generate â”‚
â”‚  {prompt, doc_id}â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GRAPHE LANGGRAPH               â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ ROUTER       â”‚              â”‚
â”‚  â”‚ "document?"  â”‚              â”‚
â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚      â”‚ OUI                     â”‚
â”‚      â–¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ RETRIEVAL    â”‚              â”‚
â”‚  â”‚ â””â”€> RAG      â”‚              â”‚
â”‚  â”‚   ChromaDB   â”‚              â”‚
â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚      â”‚                         â”‚
â”‚      â–¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ WRITER       â”‚              â”‚
â”‚  â”‚ â””â”€> Gemini   â”‚              â”‚
â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚      â”‚                         â”‚
â”‚      â””â”€> RÃ©sultat              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ {generated_text, sources, chunks}
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND       â”‚
â”‚  Affiche rÃ©sultatâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### MODE 2: ARXIV (Recherche en temps rÃ©el)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UTILISATEUR â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Question sur arXiv
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND       â”‚
â”‚  POST /arxiv/   â”‚
â”‚  generate       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND routes.py              â”‚
â”‚                                 â”‚
â”‚  1. search_arxiv()              â”‚
â”‚     â””â”€> arxiv_client.py         â”‚
â”‚         â””â”€> API arXiv           â”‚
â”‚                                 â”‚
â”‚  2. download_pdf() (Ã—3)         â”‚
â”‚     â””â”€> TÃ©lÃ©charge PDFs         â”‚
â”‚                                 â”‚
â”‚  3. ingest_document() (Ã—3)      â”‚
â”‚     â””â”€> Indexe avec mÃ©tadonnÃ©es â”‚
â”‚                                 â”‚
â”‚  4. graph.invoke()              â”‚
â”‚     â””â”€> MÃªme flux que mode 1    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ RÃ©sultat avec sources arXiv
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND       â”‚
â”‚  Affiche rÃ©sultatâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ§  ARCHITECTURE DES AGENTS

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ENTRY     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ROUTER    â”‚
                    â”‚   AGENT     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                â”‚                â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
    â”‚ Document? â”‚   â”‚  Pas de   â”‚   â”‚ retrieved â”‚
    â”‚    OUI    â”‚   â”‚ document  â”‚   â”‚  exists?  â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
          â”‚               â”‚                â”‚
          â”‚               â”‚                â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                     â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
    â”‚   â”‚  RETRIEVAL AGENT      â”‚
    â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚   â”‚  â”‚ query_top_k()   â”‚  â”‚
    â”‚   â”‚  â”‚ â””â”€> ChromaDB    â”‚  â”‚
    â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚               â”‚
                    â–¼               â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
          â”‚   WRITER AGENT      â”‚   â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
          â”‚  â”‚ build_prompt()â”‚  â”‚   â”‚
          â”‚  â”‚ generate_text()â”‚ â”‚   â”‚
          â”‚  â”‚ â””â”€> Gemini    â”‚  â”‚   â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                     â”‚              â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     END     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ—„ï¸ SYSTÃˆME RAG - DÃ‰TAILS

### INGESTION (Indexation)

```
Document PDF/TXT
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ loader.py    â”‚ â†’ Extrait texte (page par page si PDF)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ chunker.py   â”‚ â†’ DÃ©coupe en chunks de 500 mots (overlap 100)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚embeddings.py â”‚ â†’ GÃ©nÃ¨re vecteur 384D par chunk
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚chroma_store  â”‚ â†’ Sauvegarde: {texte, embedding, mÃ©tadonnÃ©es}
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
   ChromaDB
```

### RECHERCHE (Retrieval)

```
Question utilisateur
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚embeddings.py â”‚ â†’ GÃ©nÃ¨re vecteur de la question
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚chroma_store  â”‚ â†’ Recherche vectorielle (similaritÃ© cosinus)
â”‚query_top_k() â”‚ â†’ Top 5 chunks les plus similaires
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
   Chunks avec scores
```

---

## ðŸ“¦ STRUCTURE DE DONNÃ‰ES

### ContentState (Ã‰tat partagÃ© entre agents)

```python
{
    "prompt": "Quelles sont les architectures...",
    
    "document": "doc_id_xyz" | None,
    
    "retrieved_chunks": [
        {
            "text": "Le texte du chunk...",
            "metadata": {
                "source": "paper.pdf",
                "page": 5,
                "title": "Multimodal AI...",
                "authors": "Smith | Doe",
                "published": "2024-01-15"
            },
            "score": 0.85  # distance
        },
        ...
    ],
    
    "generated_text": "D'aprÃ¨s les documents...",
    
    "sources": [
        {
            "source": "paper.pdf",
            "page": 5,
            "title": "...",
            "authors": "...",
            "published": "..."
        },
        ...
    ]
}
```

---

## ðŸ”— DÃ‰PENDANCES ENTRE FICHIERS

### Backend - Flux d'appels

```
main.py
  â””â”€> routes.py
        â”œâ”€> content_graph.py (build_graph)
        â”‚     â”œâ”€> router_agent.py
        â”‚     â”œâ”€> retrieval_agent.py
        â”‚     â”‚     â””â”€> chroma_store.py
        â”‚     â”‚           â””â”€> embeddings.py
        â”‚     â””â”€> writer_agent.py
        â”‚           â””â”€> llm_service.py
        â”‚
        â”œâ”€> ingest.py
        â”‚     â”œâ”€> loader.py
        â”‚     â”œâ”€> chunker.py
        â”‚     â”œâ”€> embeddings.py
        â”‚     â””â”€> chroma_store.py
        â”‚
        â””â”€> arxiv_client.py
              â””â”€> ingest.py
```

### Frontend - Flux de composants

```
index.js
  â””â”€> App.js
        â”œâ”€> HomePage
        â”œâ”€> ModeSelector
        â”œâ”€> UploadSection â†’ POST /ingest
        â”œâ”€> QuerySection â†’ POST /generate ou /arxiv/generate
        â””â”€> ResultsSection
```

---

## âš¡ FLUX RAPIDE - Vue d'ensemble

```
USER â†’ FRONTEND â†’ API ROUTE â†’ GRAPHE â†’ AGENTS â†’ SERVICES â†’ RETOUR
  â”‚        â”‚          â”‚         â”‚        â”‚         â”‚          â”‚
  â”‚        â”‚          â”‚         â”‚        â”‚         â”‚          â”‚
  â–¼        â–¼          â–¼         â–¼        â–¼         â–¼          â–¼
Upload  POST     routes.py  Router  Retrieval  ChromaDB   JSON
Question /ingest    â”‚        â”‚       â”‚         â”‚          â”‚
        POST      â”‚        â”‚       â”‚         â”‚          â”‚
        /generate â”‚        â”‚       â”‚         â”‚          â”‚
                  â”‚        â”‚       â”‚         â”‚          â”‚
                  â”‚        â”‚       â””â”€> Writerâ†’ Gemini   â”‚
                  â”‚        â”‚                           â”‚
                  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           Affichage rÃ©sultats
```

---

FIN DU DIAGRAMME ðŸŽ¯

